os: linux
dist: bionic
language: python

branches:
  only:
  - master

jobs:
  include:
    - name: Linux | arm64 | Python 3.6
      python: 3.6
      arch: arm64
      env: PYTHON=python

    - name: Linux | ppc64le | Python 3.6
      python: 3.6
      arch: ppc64le
      env: PYTHON=python


    - name: Linux | s390x | Python 3.6
      python: 3.6
      arch: s390x
      env: PYTHON=python

before_install:
- sudo add-apt-repository -y ppa:projectatomic/ppa
- sudo apt-get update -qq
- sudo apt-get install -qq -y software-properties-common podman
- sudo mkdir -p /etc/containers
- sudo sh -c 'echo -e "[registries.search]\nregistries = [\"docker.io\"]" > /etc/containers/registries.conf'
- mkdir -p ${HOME}/.podman/bin
- ln -s $(which podman) ${HOME}/.podman/bin/docker
- export PATH=${HOME}/.podman/bin:$PATH

install: $PYTHON -m pip install -e ".[dev]" pytest-custom-exit-code

script: $PYTHON ./bin/run_tests.py
